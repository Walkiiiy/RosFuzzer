{
  "fn_def_list": [
    {
      "fn_code": "ares_status_t ares_parse_into_addrinfo(const ares_dns_record_t *dnsrec,\n                                       ares_bool_t    cname_only_is_enodata,\n                                       unsigned short port,\n                                       struct ares_addrinfo *ai)\n{\n  ares_status_t               status;\n  size_t                      i;\n  size_t                      ancount;\n  const char                 *hostname  = NULL;\n  ares_bool_t                 got_a     = ARES_FALSE;\n  ares_bool_t                 got_aaaa  = ARES_FALSE;\n  ares_bool_t                 got_cname = ARES_FALSE;\n  struct ares_addrinfo_cname *cnames    = NULL;\n  struct ares_addrinfo_node  *nodes     = NULL;\n\n  /* Save question hostname */\n  status = ares_dns_record_query_get(dnsrec, 0, &hostname, NULL, NULL);\n  if (status != ARES_SUCCESS) {\n    goto done; /* LCOV_EXCL_LINE: DefensiveCoding */\n  }\n\n  ancount = ares_dns_record_rr_cnt(dnsrec, ARES_SECTION_ANSWER);\n  if (ancount == 0) {\n    status = ARES_ENODATA;\n    goto done;\n  }\n\n  for (i = 0; i < ancount; i++) {\n    ares_dns_rec_type_t  rtype;\n    const ares_dns_rr_t *rr =\n      ares_dns_record_rr_get_const(dnsrec, ARES_SECTION_ANSWER, i);\n\n    if (ares_dns_rr_get_class(rr) != ARES_CLASS_IN) {\n      continue;\n    }\n\n    rtype = ares_dns_rr_get_type(rr);\n\n    /* Issue #683\n     * Old code did this hostname sanity check, however it appears this is\n     * flawed logic.  Other resolvers don't do this sanity check.  Leaving\n     * this code commented out for future reference.\n     *\n     * rname = ares_dns_rr_get_name(rr);\n     * if ((rtype == ARES_REC_TYPE_A || rtype == ARES_REC_TYPE_AAAA) &&\n     *     !ares_strcaseeq(rname, hostname)) {\n     *   continue;\n     * }\n     */\n\n    if (rtype == ARES_REC_TYPE_CNAME) {\n      struct ares_addrinfo_cname *cname;\n\n      got_cname = ARES_TRUE;\n      /* replace hostname with data from cname */\n      hostname = ares_dns_rr_get_str(rr, ARES_RR_CNAME_CNAME);\n\n      cname = ares_append_addrinfo_cname(&cnames);\n      if (cname == NULL) {\n        status = ARES_ENOMEM; /* LCOV_EXCL_LINE: OutOfMemory */\n        goto done;            /* LCOV_EXCL_LINE: OutOfMemory */\n      }\n      cname->ttl   = (int)ares_dns_rr_get_ttl(rr);\n      cname->alias = ares_strdup(ares_dns_rr_get_name(rr));\n      if (cname->alias == NULL) {\n        status = ARES_ENOMEM; /* LCOV_EXCL_LINE: OutOfMemory */\n        goto done;            /* LCOV_EXCL_LINE: OutOfMemory */\n      }\n      cname->name = ares_strdup(hostname);\n      if (cname->name == NULL) {\n        status = ARES_ENOMEM; /* LCOV_EXCL_LINE: OutOfMemory */\n        goto done;            /* LCOV_EXCL_LINE: OutOfMemory */\n      }\n    } else if (rtype == ARES_REC_TYPE_A) {\n      got_a = ARES_TRUE;\n      status =\n        ares_append_ai_node(AF_INET, port, ares_dns_rr_get_ttl(rr),\n                            ares_dns_rr_get_addr(rr, ARES_RR_A_ADDR), &nodes);\n      if (status != ARES_SUCCESS) {\n        goto done; /* LCOV_EXCL_LINE: OutOfMemory */\n      }\n    } else if (rtype == ARES_REC_TYPE_AAAA) {\n      got_aaaa = ARES_TRUE;\n      status   = ares_append_ai_node(AF_INET6, port, ares_dns_rr_get_ttl(rr),\n                                     ares_dns_rr_get_addr6(rr, ARES_RR_AAAA_ADDR),\n                                     &nodes);\n      if (status != ARES_SUCCESS) {\n        goto done; /* LCOV_EXCL_LINE: OutOfMemory */\n      }\n    } else {\n      continue;\n    }\n  }\n\n  if (!got_a && !got_aaaa &&\n      (!got_cname || (got_cname && cname_only_is_enodata))) {\n    status = ARES_ENODATA;\n    goto done;\n  }\n\n  /* save the hostname as ai->name */\n  if (ai->name == NULL || !ares_strcaseeq(ai->name, hostname)) {\n    ares_free(ai->name);\n    ai->name = ares_strdup(hostname);\n    if (ai->name == NULL) {\n      status = ARES_ENOMEM; /* LCOV_EXCL_LINE: OutOfMemory */\n      goto done;            /* LCOV_EXCL_LINE: OutOfMemory */\n    }\n  }\n\n  if (got_a || got_aaaa) {\n    ares_addrinfo_cat_nodes(&ai->nodes, nodes);\n    nodes = NULL;\n  }\n\n  if (got_cname) {\n    ares_addrinfo_cat_cnames(&ai->cnames, cnames);\n    cnames = NULL;\n  }\n\ndone:\n  ares_freeaddrinfo_cnames(cnames);\n  ares_freeaddrinfo_nodes(nodes);\n\n  /* compatibility */\n  if (status == ARES_EBADNAME) {\n    status = ARES_EBADRESP;\n  }\n\n  return status;\n}",
      "fn_code_pos": [
        [
          47,
          0
        ],
        [
          177,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "ares_parse_into_addrinfo",
        "parameters": {
          "dnsrec": "ares_dns_record_t",
          "cname_only_is_enodata": "ares_bool_t",
          "port": "unsigned short",
          "ai": "struct ares_addrinfo"
        },
        "return_type": "ares_status_t"
      }
    }
  ],
  "fn_declaraion": [],
  "class_node_list": {},
  "struct_node_list": [
    [
      "struct ares_addrinfo",
      {},
      "",
      [
        50,
        39
      ],
      [
        50,
        59
      ]
    ],
    [
      "struct ares_addrinfo_cname",
      {},
      "",
      [
        59,
        2
      ],
      [
        59,
        28
      ]
    ],
    [
      "struct ares_addrinfo_node",
      {},
      "",
      [
        60,
        2
      ],
      [
        60,
        27
      ]
    ],
    [
      "struct ares_addrinfo_cname",
      {},
      "",
      [
        98,
        6
      ],
      [
        98,
        32
      ]
    ]
  ],
  "include_list": [
    [
      "#include \"ares_private.h\"\n",
      [
        26,
        0
      ],
      [
        27,
        0
      ]
    ],
    [
      "#  include <netinet/in.h>\n",
      [
        29,
        0
      ],
      [
        30,
        0
      ]
    ],
    [
      "#  include <netdb.h>\n",
      [
        32,
        0
      ],
      [
        33,
        0
      ]
    ],
    [
      "#  include <arpa/inet.h>\n",
      [
        35,
        0
      ],
      [
        36,
        0
      ]
    ],
    [
      "#  include <strings.h>\n",
      [
        39,
        0
      ],
      [
        40,
        0
      ]
    ],
    [
      "#  include <limits.h>\n",
      [
        43,
        0
      ],
      [
        44,
        0
      ]
    ]
  ],
  "global_variables": [],
  "enumerate_node_list": []
}