{
  "fn_def_list": [
    {
      "fn_code": "int ares_getsock(const ares_channel_t *channel, ares_socket_t *socks,\n                 int numsocks) /* size of the 'socks' array */\n{\n  ares_slist_node_t *snode;\n  size_t             sockindex = 0;\n  unsigned int       bitmap    = 0;\n  unsigned int       setbits   = 0xffffffff;\n\n  /* Are there any active queries? */\n  size_t             active_queries;\n\n  if (channel == NULL || numsocks <= 0) {\n    return 0;\n  }\n\n  ares_channel_lock(channel);\n\n  active_queries = ares_llist_len(channel->all_queries);\n\n  for (snode = ares_slist_node_first(channel->servers); snode != NULL;\n       snode = ares_slist_node_next(snode)) {\n    ares_server_t     *server = ares_slist_node_val(snode);\n    ares_llist_node_t *node;\n\n    for (node = ares_llist_node_first(server->connections); node != NULL;\n         node = ares_llist_node_next(node)) {\n      const ares_conn_t *conn = ares_llist_node_val(node);\n\n      if (sockindex >= (size_t)numsocks || sockindex >= ARES_GETSOCK_MAXNUM) {\n        break;\n      }\n\n      /* We only need to register interest in UDP sockets if we have\n       * outstanding queries.\n       */\n      if (!active_queries && !(conn->flags & ARES_CONN_FLAG_TCP)) {\n        continue;\n      }\n\n      socks[sockindex] = conn->fd;\n\n      if (active_queries || conn->flags & ARES_CONN_FLAG_TCP) {\n        bitmap |= ARES_GETSOCK_READABLE(setbits, sockindex);\n      }\n\n      if (conn->state_flags & ARES_CONN_STATE_WRITE) {\n        /* then the tcp socket is also writable! */\n        bitmap |= ARES_GETSOCK_WRITABLE(setbits, sockindex);\n      }\n\n      sockindex++;\n    }\n  }\n\n  ares_channel_unlock(channel);\n  return (int)bitmap;\n}",
      "fn_code_pos": [
        [
          28,
          0
        ],
        [
          84,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "ares_getsock",
        "parameters": {
          "channel": "ares_channel_t",
          "socks": "ares_socket_t",
          "numsocks": "int"
        },
        "return_type": "int"
      }
    }
  ],
  "fn_declaraion": [],
  "class_node_list": {},
  "struct_node_list": [],
  "include_list": [
    [
      "#include \"ares_private.h\"\n",
      [
        26,
        0
      ],
      [
        27,
        0
      ]
    ]
  ],
  "global_variables": [],
  "enumerate_node_list": []
}