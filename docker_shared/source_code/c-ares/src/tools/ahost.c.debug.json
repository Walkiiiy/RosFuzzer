{
  "fn_def_list": [
    {
      "fn_code": "int         main(int argc, char **argv)\n{\n  struct ares_options  options;\n  int                  optmask = 0;\n  ares_channel_t      *channel;\n  int                  status;\n  int                  nfds;\n  int                  c;\n  int                  addr_family = AF_UNSPEC;\n  fd_set               read_fds;\n  fd_set               write_fds;\n  struct timeval      *tvp;\n  struct timeval       tv;\n  struct in_addr       addr4;\n  struct ares_in6_addr addr6;\n  ares_getopt_state_t  state;\n  char                *servers = NULL;\n\n#ifdef USE_WINSOCK\n  WORD    wVersionRequested = MAKEWORD(USE_WINSOCK, USE_WINSOCK);\n  WSADATA wsaData;\n  WSAStartup(wVersionRequested, &wsaData);\n#endif\n\n  memset(&options, 0, sizeof(options));\n\n  status = ares_library_init(ARES_LIB_INIT_ALL);\n  if (status != ARES_SUCCESS) {\n    fprintf(stderr, \"ares_library_init: %s\\n\", ares_strerror(status));\n    return RV_SYSERR;\n  }\n\n  ares_getopt_init(&state, argc, (const char * const *)argv);\n  while ((c = ares_getopt(&state, \"dt:h?D:s:\")) != -1) {\n    switch (c) {\n      case 'd':\n#ifdef WATT32\n        dbug_init();\n#endif\n        break;\n      case 'D':\n        optmask |= ARES_OPT_DOMAINS;\n        options.ndomains++;\n        options.domains = (char **)realloc(\n          options.domains, (size_t)options.ndomains * sizeof(char *));\n        options.domains[options.ndomains - 1] = strdup(state.optarg);\n        break;\n      case 't':\n        if (ares_strcaseeq(state.optarg, \"a\")) {\n          addr_family = AF_INET;\n        } else if (ares_strcaseeq(state.optarg, \"aaaa\")) {\n          addr_family = AF_INET6;\n        } else if (ares_strcaseeq(state.optarg, \"u\")) {\n          addr_family = AF_UNSPEC;\n        } else {\n          usage();\n        }\n        break;\n      case 's':\n        if (state.optarg == NULL) {\n          fprintf(stderr, \"%s\", \"missing servers\");\n          usage();\n          break;\n        }\n        if (servers) {\n          free(servers);\n        }\n        servers = strdup(state.optarg);\n        break;\n      case 'h':\n      case '?':\n        print_help_info_ahost();\n        break;\n      default:\n        usage();\n        break;\n    }\n  }\n\n  argc -= state.optind;\n  argv += state.optind;\n  if (argc < 1) {\n    usage();\n  }\n\n  status = ares_init_options(&channel, &options, optmask);\n  if (status != ARES_SUCCESS) {\n    free(servers);\n    fprintf(stderr, \"ares_init: %s\\n\", ares_strerror(status));\n    return RV_SYSERR;\n  }\n\n  if (servers) {\n    status = ares_set_servers_csv(channel, servers);\n    if (status != ARES_SUCCESS) {\n      fprintf(stderr, \"ares_set_serveres_csv: %s\\n\", ares_strerror(status));\n      free(servers);\n      usage();\n      return RV_MISUSE;\n    }\n    free(servers);\n  }\n\n  /* Initiate the queries, one per command-line argument. */\n  for (; *argv; argv++) {\n    if (ares_inet_pton(AF_INET, *argv, &addr4) == 1) {\n      ares_gethostbyaddr(channel, &addr4, sizeof(addr4), AF_INET, callback,\n                         *argv);\n    } else if (ares_inet_pton(AF_INET6, *argv, &addr6) == 1) {\n      ares_gethostbyaddr(channel, &addr6, sizeof(addr6), AF_INET6, callback,\n                         *argv);\n    } else {\n      struct ares_addrinfo_hints hints;\n      memset(&hints, 0, sizeof(hints));\n      hints.ai_family = addr_family;\n      ares_getaddrinfo(channel, *argv, NULL, &hints, ai_callback, *argv);\n    }\n  }\n\n  /* Wait for all queries to complete. */\n  for (;;) {\n    int res;\n    FD_ZERO(&read_fds);\n    FD_ZERO(&write_fds);\n    nfds = ares_fds(channel, &read_fds, &write_fds);\n    if (nfds == 0) {\n      break;\n    }\n    tvp = ares_timeout(channel, NULL, &tv);\n    if (tvp == NULL) {\n      break;\n    }\n    res = select(nfds, &read_fds, &write_fds, NULL, tvp);\n    if (-1 == res) {\n      break;\n    }\n    ares_process(channel, &read_fds, &write_fds);\n  }\n\n  ares_destroy(channel);\n\n  ares_library_cleanup();\n\n#ifdef USE_WINSOCK\n  WSACleanup();\n#endif\n\n  return final_rv;\n}",
      "fn_code_pos": [
        [
          61,
          0
        ],
        [
          209,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "main",
        "parameters": {
          "argc": "int",
          "argv": "char"
        },
        "return_type": "int"
      }
    },
    {
      "fn_code": "static void callback(void *arg, int status, int timeouts, struct hostent *host)\n{\n  char **p;\n\n  (void)timeouts;\n\n  if (status != ARES_SUCCESS) {\n    fprintf(stderr, \"%s: %s\\n\", (char *)arg, ares_strerror(status));\n    final_rv = RV_FAIL;\n    return;\n  }\n\n  for (p = host->h_addr_list; *p; p++) {\n    char addr_buf[46] = \"??\";\n\n    ares_inet_ntop(host->h_addrtype, *p, addr_buf, sizeof(addr_buf));\n    printf(\"%-32s\\t%s\", host->h_name, addr_buf);\n    puts(\"\");\n  }\n}",
      "fn_code_pos": [
        [
          211,
          0
        ],
        [
          230,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "callback",
        "parameters": {
          "arg": "void",
          "status": "int",
          "timeouts": "int",
          "host": "struct hostent"
        },
        "return_type": "void"
      }
    },
    {
      "fn_code": "static void ai_callback(void *arg, int status, int timeouts,\n                        struct ares_addrinfo *result)\n{\n  struct ares_addrinfo_node *node = NULL;\n  (void)timeouts;\n\n\n  if (status != ARES_SUCCESS) {\n    fprintf(stderr, \"%s: %s\\n\", (char *)arg, ares_strerror(status));\n    final_rv = RV_FAIL;\n    return;\n  }\n\n  for (node = result->nodes; node != NULL; node = node->ai_next) {\n    char        addr_buf[64] = \"\";\n    const void *ptr          = NULL;\n    if (node->ai_family == AF_INET) {\n      const struct sockaddr_in *in_addr =\n        (const struct sockaddr_in *)((void *)node->ai_addr);\n      ptr = &in_addr->sin_addr;\n    } else if (node->ai_family == AF_INET6) {\n      const struct sockaddr_in6 *in_addr =\n        (const struct sockaddr_in6 *)((void *)node->ai_addr);\n      ptr = &in_addr->sin6_addr;\n    } else {\n      continue;\n    }\n    ares_inet_ntop(node->ai_family, ptr, addr_buf, sizeof(addr_buf));\n    printf(\"%-32s\\t%s\\n\", result->name, addr_buf);\n  }\n\n  ares_freeaddrinfo(result);\n}",
      "fn_code_pos": [
        [
          232,
          0
        ],
        [
          264,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "ai_callback",
        "parameters": {
          "arg": "void",
          "status": "int",
          "timeouts": "int",
          "result": "struct ares_addrinfo"
        },
        "return_type": "void"
      }
    },
    {
      "fn_code": "static void usage(void)\n{\n  fprintf(stderr, \"usage: ahost [-h] [-d] [[-D {domain}] ...] [-s {server}] \"\n                  \"[-t {a|aaaa|u}] {host|addr} ...\\n\");\n  exit(RV_MISUSE);\n}",
      "fn_code_pos": [
        [
          266,
          0
        ],
        [
          271,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "usage",
        "parameters": {},
        "return_type": "void"
      }
    },
    {
      "fn_code": "static void print_help_info_ahost(void)\n{\n  /* Split due to maximum c89 string literal of 509 bytes */\n  printf(\"ahost, version %s\\n\\n\", ARES_VERSION_STR);\n  printf(\n    \"usage: ahost [-h] [-d] [-D domain] [-s server] [-t a|aaaa|u] host|addr \"\n    \"...\\n\\n\");\n  printf(\n    \"  -h : Display this help and exit.\\n\"\n    \"  -d : Print some extra debugging output.\\n\\n\"\n    \"  -D domain : Specify the domain to search instead of using the default \"\n    \"values\\n\");\n  printf(\n    \"  -s server : Connect to the specified DNS server, instead of the\\n\"\n    \"              system's default one(s). Servers are tried in round-robin,\\n\"\n    \"              if the previous one failed.\\n\"\n    \"  -t type   : If type is \\\"a\\\", print the A record.\\n\");\n  printf(\n    \"              If type is \\\"aaaa\\\", print the AAAA record.\\n\"\n    \"              If type is \\\"u\\\" (default), print both A and AAAA records.\\n\"\n    \"\\n\");\n  exit(RV_OK);\n}",
      "fn_code_pos": [
        [
          274,
          0
        ],
        [
          296,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "print_help_info_ahost",
        "parameters": {},
        "return_type": "void"
      }
    }
  ],
  "fn_declaraion": [
    {
      "fn_code": "callback(void *arg, int status, int timeouts, struct hostent *host)",
      "fn_dec_pos": [
        [
          53,
          12
        ],
        [
          53,
          79
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "callback",
        "parameters": {
          "arg": "void",
          "status": "int",
          "timeouts": "int",
          "host": "struct hostent"
        },
        "return_type": "void"
      }
    },
    {
      "fn_code": "ai_callback(void *arg, int status, int timeouts,\n                        struct ares_addrinfo *result)",
      "fn_dec_pos": [
        [
          54,
          12
        ],
        [
          55,
          53
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "ai_callback",
        "parameters": {
          "arg": "void",
          "status": "int",
          "timeouts": "int",
          "result": "struct ares_addrinfo"
        },
        "return_type": "void"
      }
    },
    {
      "fn_code": "usage(void)",
      "fn_dec_pos": [
        [
          56,
          12
        ],
        [
          56,
          23
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "usage",
        "parameters": {},
        "return_type": "void"
      }
    },
    {
      "fn_code": "print_help_info_ahost(void)",
      "fn_dec_pos": [
        [
          57,
          12
        ],
        [
          57,
          39
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "print_help_info_ahost",
        "parameters": {},
        "return_type": "void"
      }
    }
  ],
  "class_node_list": {},
  "struct_node_list": [
    [
      "struct hostent",
      {},
      "",
      [
        53,
        58
      ],
      [
        53,
        72
      ]
    ],
    [
      "struct ares_addrinfo",
      {},
      "",
      [
        55,
        24
      ],
      [
        55,
        44
      ]
    ],
    [
      "struct ares_options",
      {},
      "",
      [
        63,
        2
      ],
      [
        63,
        21
      ]
    ],
    [
      "struct timeval",
      {},
      "",
      [
        72,
        2
      ],
      [
        72,
        16
      ]
    ],
    [
      "struct timeval",
      {},
      "",
      [
        73,
        2
      ],
      [
        73,
        16
      ]
    ],
    [
      "struct in_addr",
      {},
      "",
      [
        74,
        2
      ],
      [
        74,
        16
      ]
    ],
    [
      "struct ares_in6_addr",
      {},
      "",
      [
        75,
        2
      ],
      [
        75,
        22
      ]
    ],
    [
      "struct ares_addrinfo_hints",
      {},
      "",
      [
        173,
        6
      ],
      [
        173,
        32
      ]
    ],
    [
      "struct hostent",
      {},
      "",
      [
        211,
        58
      ],
      [
        211,
        72
      ]
    ],
    [
      "struct ares_addrinfo",
      {},
      "",
      [
        233,
        24
      ],
      [
        233,
        44
      ]
    ],
    [
      "struct ares_addrinfo_node",
      {},
      "",
      [
        235,
        2
      ],
      [
        235,
        27
      ]
    ],
    [
      "struct sockaddr_in",
      {},
      "",
      [
        249,
        12
      ],
      [
        249,
        30
      ]
    ],
    [
      "struct sockaddr_in",
      {},
      "",
      [
        250,
        15
      ],
      [
        250,
        33
      ]
    ],
    [
      "struct sockaddr_in6",
      {},
      "",
      [
        253,
        12
      ],
      [
        253,
        31
      ]
    ],
    [
      "struct sockaddr_in6",
      {},
      "",
      [
        254,
        15
      ],
      [
        254,
        34
      ]
    ]
  ],
  "include_list": [
    [
      "#include \"ares_setup.h\"\n",
      [
        27,
        0
      ],
      [
        28,
        0
      ]
    ],
    [
      "#  include <netinet/in.h>\n",
      [
        30,
        0
      ],
      [
        31,
        0
      ]
    ],
    [
      "#  include <arpa/inet.h>\n",
      [
        31,
        0
      ],
      [
        32,
        0
      ]
    ],
    [
      "#  include <netdb.h>\n",
      [
        32,
        0
      ],
      [
        33,
        0
      ]
    ],
    [
      "#  include <strings.h>\n",
      [
        36,
        0
      ],
      [
        37,
        0
      ]
    ],
    [
      "#include \"ares.h\"\n",
      [
        39,
        0
      ],
      [
        40,
        0
      ]
    ],
    [
      "#include \"ares_dns.h\"\n",
      [
        40,
        0
      ],
      [
        41,
        0
      ]
    ],
    [
      "#include \"ares_getopt.h\"\n",
      [
        41,
        0
      ],
      [
        42,
        0
      ]
    ],
    [
      "#include \"ares_ipv6.h\"\n",
      [
        42,
        0
      ],
      [
        43,
        0
      ]
    ],
    [
      "#include \"ares_str.h\"\n",
      [
        44,
        0
      ],
      [
        45,
        0
      ]
    ]
  ],
  "global_variables": [],
  "enumerate_node_list": []
}