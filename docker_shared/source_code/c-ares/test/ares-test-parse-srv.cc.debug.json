{
  "fn_def_list": [
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplyOK) {\n  DNSPacket pkt;\n  pkt.set_qid(0x1234).set_response().set_aa()\n    .add_question(new DNSQuestion(\"example.com\", T_SRV))\n    .add_answer(new DNSSrvRR(\"example.com\", 100, 10, 20, 30, \"srv.example.com\"))\n    .add_answer(new DNSSrvRR(\"example.com\", 100, 11, 21, 31, \"srv2.example.com\"));\n  std::vector<byte> data = pkt.data();\n\n  struct ares_srv_reply* srv = nullptr;\n  EXPECT_EQ(ARES_SUCCESS, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  ASSERT_NE(nullptr, srv);\n\n  EXPECT_EQ(\"srv.example.com\", std::string(srv->host));\n  EXPECT_EQ(10, srv->priority);\n  EXPECT_EQ(20, srv->weight);\n  EXPECT_EQ(30, srv->port);\n\n  struct ares_srv_reply* srv2 = srv->next;\n  ASSERT_NE(nullptr, srv2);\n  EXPECT_EQ(\"srv2.example.com\", std::string(srv2->host));\n  EXPECT_EQ(11, srv2->priority);\n  EXPECT_EQ(21, srv2->weight);\n  EXPECT_EQ(31, srv2->port);\n  EXPECT_EQ(nullptr, srv2->next);\n\n  ares_free_data(srv);\n}",
      "fn_code_pos": [
        [
          34,
          0
        ],
        [
          60,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    },
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplySingle) {\n  DNSPacket pkt;\n  pkt.set_qid(0x1234).set_response().set_aa()\n    .add_question(new DNSQuestion(\"example.abc.def.com\", T_SRV))\n    .add_answer(new DNSSrvRR(\"example.abc.def.com\", 180, 0, 10, 8160, \"example.abc.def.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else1.where.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else2.where.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else3.where.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else4.where.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else5.where.com\"))\n    .add_additional(new DNSARR(\"else2.where.com\", 42, {172,19,0,1}))\n    .add_additional(new DNSARR(\"else5.where.com\", 42, {172,19,0,2}));\n  std::vector<byte> data = pkt.data();\n\n  struct ares_srv_reply* srv = nullptr;\n  EXPECT_EQ(ARES_SUCCESS, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  ASSERT_NE(nullptr, srv);\n\n  EXPECT_EQ(\"example.abc.def.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(10, srv->weight);\n  EXPECT_EQ(8160, srv->port);\n  EXPECT_EQ(nullptr, srv->next);\n\n  ares_free_data(srv);\n}",
      "fn_code_pos": [
        [
          62,
          0
        ],
        [
          87,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    },
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplyMalformed) {\n  std::vector<byte> data = {\n    0x12, 0x34,  // qid\n    0x84, // response + query + AA + not-TC + not-RD\n    0x00, // not-RA + not-Z + not-AD + not-CD + rc=NoError\n    0x00, 0x01,  // num questions\n    0x00, 0x01,  // num answer RRs\n    0x00, 0x00,  // num authority RRs\n    0x00, 0x00,  // num additional RRs\n    // Question\n    0x07, 'e', 'x', 'a', 'm', 'p', 'l', 'e',\n    0x03, 'c', 'o', 'm',\n    0x00,\n    0x00, 0x21,  // type SRV\n    0x00, 0x01,  // class IN\n    // Answer 1\n    0x07, 'e', 'x', 'a', 'm', 'p', 'l', 'e',\n    0x03, 'c', 'o', 'm',\n    0x00,\n    0x00, 0x21,  // RR type\n    0x00, 0x01,  // class IN\n    0x01, 0x02, 0x03, 0x04, // TTL\n    0x00, 0x04,  // rdata length -- too short\n    0x02, 0x03, 0x04, 0x05,\n  };\n\n  struct ares_srv_reply* srv = nullptr;\n  EXPECT_EQ(ARES_EBADRESP, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  ASSERT_EQ(nullptr, srv);\n}",
      "fn_code_pos": [
        [
          89,
          0
        ],
        [
          118,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    },
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplyMultiple) {\n  DNSPacket pkt;\n  pkt.set_qid(0x1234).set_response().set_ra().set_rd()\n    .add_question(new DNSQuestion(\"srv.example.com\", T_SRV))\n    .add_answer(new DNSSrvRR(\"srv.example.com\", 300, 0, 5, 6789, \"a1.srv.example.com\"))\n    .add_answer(new DNSSrvRR(\"srv.example.com\", 300, 0, 5, 4567, \"a2.srv.example.com\"))\n    .add_answer(new DNSSrvRR(\"srv.example.com\", 300, 0, 5, 5678, \"a3.srv.example.com\"))\n    .add_auth(new DNSNsRR(\"example.com\", 300, \"ns1.example.com\"))\n    .add_auth(new DNSNsRR(\"example.com\", 300, \"ns2.example.com\"))\n    .add_auth(new DNSNsRR(\"example.com\", 300, \"ns3.example.com\"))\n    .add_additional(new DNSARR(\"a1.srv.example.com\", 300, {172,19,1,1}))\n    .add_additional(new DNSARR(\"a2.srv.example.com\", 300, {172,19,1,2}))\n    .add_additional(new DNSARR(\"a3.srv.example.com\", 300, {172,19,1,3}))\n    .add_additional(new DNSARR(\"n1.example.com\", 300, {172,19,0,1}))\n    .add_additional(new DNSARR(\"n2.example.com\", 300, {172,19,0,2}))\n    .add_additional(new DNSARR(\"n3.example.com\", 300, {172,19,0,3}));\n  std::vector<byte> data = pkt.data();\n\n  struct ares_srv_reply* srv0 = nullptr;\n  EXPECT_EQ(ARES_SUCCESS, ares_parse_srv_reply(data.data(), (int)data.size(), &srv0));\n  ASSERT_NE(nullptr, srv0);\n  struct ares_srv_reply* srv = srv0;\n\n  EXPECT_EQ(\"a1.srv.example.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(5, srv->weight);\n  EXPECT_EQ(6789, srv->port);\n  EXPECT_NE(nullptr, srv->next);\n  srv = srv->next;\n\n  EXPECT_EQ(\"a2.srv.example.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(5, srv->weight);\n  EXPECT_EQ(4567, srv->port);\n  EXPECT_NE(nullptr, srv->next);\n  srv = srv->next;\n\n  EXPECT_EQ(\"a3.srv.example.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(5, srv->weight);\n  EXPECT_EQ(5678, srv->port);\n  EXPECT_EQ(nullptr, srv->next);\n\n  ares_free_data(srv0);\n}",
      "fn_code_pos": [
        [
          120,
          0
        ],
        [
          164,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    },
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplyCname) {\n  DNSPacket pkt;\n  pkt.set_qid(0x1234).set_response().set_aa()\n    .add_question(new DNSQuestion(\"example.abc.def.com\", T_SRV))\n    .add_answer(new DNSCnameRR(\"example.abc.def.com\", 300, \"cname.abc.def.com\"))\n    .add_answer(new DNSSrvRR(\"cname.abc.def.com\", 300, 0, 10, 1234, \"srv.abc.def.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else1.where.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else2.where.com\"))\n    .add_auth(new DNSNsRR(\"abc.def.com\", 44, \"else3.where.com\"))\n    .add_additional(new DNSARR(\"example.abc.def.com\", 300, {172,19,0,1}))\n    .add_additional(new DNSARR(\"else1.where.com\", 42, {172,19,0,1}))\n    .add_additional(new DNSARR(\"else2.where.com\", 42, {172,19,0,2}))\n    .add_additional(new DNSARR(\"else3.where.com\", 42, {172,19,0,3}));\n  std::vector<byte> data = pkt.data();\n\n  struct ares_srv_reply* srv = nullptr;\n  EXPECT_EQ(ARES_SUCCESS, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  ASSERT_NE(nullptr, srv);\n\n  EXPECT_EQ(\"srv.abc.def.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(10, srv->weight);\n  EXPECT_EQ(1234, srv->port);\n  EXPECT_EQ(nullptr, srv->next);\n\n  ares_free_data(srv);\n}",
      "fn_code_pos": [
        [
          166,
          0
        ],
        [
          192,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    },
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplyCnameMultiple) {\n  DNSPacket pkt;\n  pkt.set_qid(0x1234).set_response().set_ra().set_rd()\n    .add_question(new DNSQuestion(\"query.example.com\", T_SRV))\n    .add_answer(new DNSCnameRR(\"query.example.com\", 300, \"srv.example.com\"))\n    .add_answer(new DNSSrvRR(\"srv.example.com\", 300, 0, 5, 6789, \"a1.srv.example.com\"))\n    .add_answer(new DNSSrvRR(\"srv.example.com\", 300, 0, 5, 4567, \"a2.srv.example.com\"))\n    .add_answer(new DNSSrvRR(\"srv.example.com\", 300, 0, 5, 5678, \"a3.srv.example.com\"))\n    .add_auth(new DNSNsRR(\"example.com\", 300, \"ns1.example.com\"))\n    .add_auth(new DNSNsRR(\"example.com\", 300, \"ns2.example.com\"))\n    .add_auth(new DNSNsRR(\"example.com\", 300, \"ns3.example.com\"))\n    .add_additional(new DNSARR(\"a1.srv.example.com\", 300, {172,19,1,1}))\n    .add_additional(new DNSARR(\"a2.srv.example.com\", 300, {172,19,1,2}))\n    .add_additional(new DNSARR(\"a3.srv.example.com\", 300, {172,19,1,3}))\n    .add_additional(new DNSARR(\"n1.example.com\", 300, {172,19,0,1}))\n    .add_additional(new DNSARR(\"n2.example.com\", 300, {172,19,0,2}))\n    .add_additional(new DNSARR(\"n3.example.com\", 300, {172,19,0,3}));\n  std::vector<byte> data = pkt.data();\n\n  struct ares_srv_reply* srv0 = nullptr;\n  EXPECT_EQ(ARES_SUCCESS, ares_parse_srv_reply(data.data(), (int)data.size(), &srv0));\n  ASSERT_NE(nullptr, srv0);\n  struct ares_srv_reply* srv = srv0;\n\n  EXPECT_EQ(\"a1.srv.example.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(5, srv->weight);\n  EXPECT_EQ(6789, srv->port);\n  EXPECT_NE(nullptr, srv->next);\n  srv = srv->next;\n\n  EXPECT_EQ(\"a2.srv.example.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(5, srv->weight);\n  EXPECT_EQ(4567, srv->port);\n  EXPECT_NE(nullptr, srv->next);\n  srv = srv->next;\n\n  EXPECT_EQ(\"a3.srv.example.com\", std::string(srv->host));\n  EXPECT_EQ(0, srv->priority);\n  EXPECT_EQ(5, srv->weight);\n  EXPECT_EQ(5678, srv->port);\n  EXPECT_EQ(nullptr, srv->next);\n\n  ares_free_data(srv0);\n}",
      "fn_code_pos": [
        [
          194,
          0
        ],
        [
          239,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    },
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplyErrors) {\n  DNSPacket pkt;\n  pkt.set_qid(0x1234).set_response().set_aa()\n    .add_question(new DNSQuestion(\"example.abc.def.com\", T_SRV))\n    .add_answer(new DNSSrvRR(\"example.abc.def.com\", 180, 0, 10, 8160, \"example.abc.def.com\"));\n  std::vector<byte> data;\n  struct ares_srv_reply* srv = nullptr;\n\n  // No question.\n  pkt.questions_.clear();\n  data = pkt.data();\n  EXPECT_EQ(ARES_EBADRESP, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  pkt.add_question(new DNSQuestion(\"example.abc.def.com\", T_SRV));\n\n#ifdef DISABLED\n  // Question != answer\n  pkt.questions_.clear();\n  pkt.add_question(new DNSQuestion(\"Axample.com\", T_SRV));\n  data = pkt.data();\n  EXPECT_EQ(ARES_ENODATA, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  pkt.questions_.clear();\n  pkt.add_question(new DNSQuestion(\"example.com\", T_SRV));\n#endif\n\n  // Two questions.\n  pkt.add_question(new DNSQuestion(\"example.abc.def.com\", T_SRV));\n  data = pkt.data();\n  EXPECT_EQ(ARES_EBADRESP, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  pkt.questions_.clear();\n  pkt.add_question(new DNSQuestion(\"64.48.32.16.in-addr.arpa\", T_PTR));\n\n  // Wrong sort of answer.\n  pkt.answers_.clear();\n  pkt.add_answer(new DNSMxRR(\"example.com\", 100, 100, \"mx1.example.com\"));\n  data = pkt.data();\n  EXPECT_EQ(ARES_SUCCESS, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  EXPECT_EQ(nullptr, srv);\n  pkt.answers_.clear();\n  pkt.add_answer(new DNSSrvRR(\"example.abc.def.com\", 180, 0, 10, 8160, \"example.abc.def.com\"));\n\n  // No answer.\n  pkt.answers_.clear();\n  data = pkt.data();\n  EXPECT_EQ(ARES_ENODATA, ares_parse_srv_reply(data.data(), (int)data.size(), &srv));\n  pkt.add_answer(new DNSSrvRR(\"example.abc.def.com\", 180, 0, 10, 8160, \"example.abc.def.com\"));\n\n  // Truncated packets.\n  data = pkt.data();\n  for (size_t len = 1; len < data.size(); len++) {\n    int rc = ares_parse_srv_reply(data.data(), (int)len, &srv);\n    EXPECT_TRUE(rc == ARES_EBADRESP || rc == ARES_EBADNAME);\n  }\n\n  // Negative Length\n  EXPECT_EQ(ARES_EBADRESP, ares_parse_srv_reply(data.data(), -1, &srv));\n}",
      "fn_code_pos": [
        [
          241,
          0
        ],
        [
          296,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    },
    {
      "fn_code": "TEST_F(LibraryTest, ParseSrvReplyAllocFail) {\n  DNSPacket pkt;\n  pkt.set_qid(0x1234).set_response().set_aa()\n    .add_question(new DNSQuestion(\"example.abc.def.com\", T_SRV))\n    .add_answer(new DNSCnameRR(\"example.com\", 300, \"c.example.com\"))\n    .add_answer(new DNSSrvRR(\"example.abc.def.com\", 180, 0, 10, 8160, \"example.abc.def.com\"));\n  std::vector<byte> data = pkt.data();\n  struct ares_srv_reply* srv = nullptr;\n\n  for (int ii = 1; ii <= 5; ii++) {\n    ClearFails();\n    SetAllocFail(ii);\n    EXPECT_EQ(ARES_ENOMEM, ares_parse_srv_reply(data.data(), (int)data.size(), &srv)) << ii;\n  }\n}",
      "fn_code_pos": [
        [
          298,
          0
        ],
        [
          312,
          1
        ]
      ],
      "class_code": "",
      "class_node_pos": [],
      "fn_meta": {
        "identifier": "TEST_F",
        "parameters": {},
        "return_type": null
      }
    }
  ],
  "fn_declaraion": [],
  "class_node_list": {},
  "struct_node_list": [
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        42,
        2
      ],
      [
        42,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        51,
        2
      ],
      [
        51,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        76,
        2
      ],
      [
        76,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        115,
        2
      ],
      [
        115,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        138,
        2
      ],
      [
        138,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        141,
        2
      ],
      [
        141,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        181,
        2
      ],
      [
        181,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        213,
        2
      ],
      [
        213,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        216,
        2
      ],
      [
        216,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        247,
        2
      ],
      [
        247,
        23
      ]
    ],
    [
      "struct ares_srv_reply",
      {},
      "",
      [
        305,
        2
      ],
      [
        305,
        23
      ]
    ]
  ],
  "include_list": [
    [
      "#include \"ares-test.h\"\n",
      [
        25,
        0
      ],
      [
        26,
        0
      ]
    ],
    [
      "#include \"dns-proto.h\"\n",
      [
        26,
        0
      ],
      [
        27,
        0
      ]
    ],
    [
      "#include <sstream>\n",
      [
        28,
        0
      ],
      [
        29,
        0
      ]
    ],
    [
      "#include <vector>\n",
      [
        29,
        0
      ],
      [
        30,
        0
      ]
    ]
  ],
  "global_variables": [],
  "enumerate_node_list": []
}